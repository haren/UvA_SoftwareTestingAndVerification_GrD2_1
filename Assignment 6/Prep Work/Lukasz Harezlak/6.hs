import Lab6
import Week6
import TimeIt
import System.Random
import Control.Monad
-- 6.1
-- 1 hour

{- 

After wikipedia:

Like the first method, this requires O(e) multiplications to complete. 
However, since the numbers used in these calculations are much smaller than 
the numbers used in the first algorithm's calculations, the computation time 
decreases by a factor of at least O(e) in this method.

-}

exM_fast :: Integer -> Integer -> Integer -> Integer
exM_fast b e m = exM_fast' 1 0 b e m where 
   exM_fast' c e' b e m
   	| e' >= e 		 = c
    | otherwise      = exM_fast' (mod (b*c) m) (e'+1) b e m

-- 6.2
-- 2 hours

-- we assume the input lists are of the same length


getRandomIntInRange :: Int -> Int -> IO Int
getRandomIntInRange x y = getStdRandom(randomR(x,y))

getRandomIntegerInRange :: Integer -> Integer -> IO Integer
getRandomIntegerInRange x y = getStdRandom(randomR(x,y))

getRandomIntsInRange :: Int -> Int -> Int -> IO [Int]
getRandomIntsInRange 0 _ _ = return []
getRandomIntsInRange n x y = do
    f <- getRandomIntInRange x y
    fs <- getRandomIntsInRange (n-1) x y
    return (f : fs)

loop_expM :: [Int] -> [Int] -> [Int] -> [Int]
loop_expM [] _ _ = []
loop_expM _ [] _ = []
loop_expM _ _ [] = []
loop_expM (b:bs) (e:es) (m:ms) = (fromIntegral(expM (toInteger(b)) (toInteger(e)) (toInteger(m)))) : ((loop_expM bs es ms))

loop_exm_fast :: [Int] -> [Int] -> [Int] -> [Int]
loop_exm_fast [] _ _ = []
loop_exm_fast _ [] _ = []
loop_exm_fast _ _ [] = []
loop_exm_fast (b:bs) (e:es) (m:ms) = (fromIntegral(expM (toInteger(b)) (toInteger(e)) (toInteger(m)))) : ((loop_exm_fast bs es ms))

test_exm :: IO()
test_exm = do 
	let times = 100
	bases <- getRandomIntsInRange times 1 1000000 
	exponents <- getRandomIntsInRange times 1 1000000 
	modulus <- getRandomIntsInRange times 1 1000000 
	timeIt $ putStrLn (show(loop_expM bases exponents modulus))
	timeIt $ putStrLn (show(loop_exm_fast bases exponents modulus))
	

{-
A lot of printing and converting distorting the results. Nevertheless, improvement can be seen.

for times = 5
*Main> test_exm
[636163,110161,474676,29153,39460]
CPU time:   4.56s
[636163,110161,474676,29153,39460]
CPU time:   4.25s
*Main> test_exm
[12549,548519,137441,24966,261682]
CPU time:   5.08s
[12549,548519,137441,24966,261682]
CPU time:   4.97s
*Main> test_exm
[471276,137793,187680,800752,18743]
CPU time:   5.06s
[471276,137793,187680,800752,18743]
CPU time:   4.95s

for times = 100
*Main> test_exm
[492665,856873,239379,236765,924,1396,68008,397275,724513,136412,644128,44331,62
909,100231,293419,314120,486562,215720,720178,31302,207929,98920,85570,552302,93
091,252937,334198,443954,69005,136320,333191,128698,791441,20221,87024,81281,851
8,77509,129906,355284,70439,51036,24169,248914,120245,132343,462109,35284,115074
,272245,664192,179611,297341,57356,216655,763410,117884,215965,342877,109448,458
819,413289,546151,180820,140693,366437,33958,47296,126009,534232,594913,41130,72
353,21119,397715,426139,36111,65019,150005,346928,662393,165344,437299,789603,23
8545,118513,318737,137592,9388,638551,344912,3688,125441,479361,73560,13556,9049
,411352,32990,628801]
CPU time: 106.58s
[492665,856873,239379,236765,924,1396,68008,397275,724513,136412,644128,44331,62
909,100231,293419,314120,486562,215720,720178,31302,207929,98920,85570,552302,93
091,252937,334198,443954,69005,136320,333191,128698,791441,20221,87024,81281,851
8,77509,129906,355284,70439,51036,24169,248914,120245,132343,462109,35284,115074
,272245,664192,179611,297341,57356,216655,763410,117884,215965,342877,109448,458
819,413289,546151,180820,140693,366437,33958,47296,126009,534232,594913,41130,72
353,21119,397715,426139,36111,65019,150005,346928,662393,165344,437299,789603,23
8545,118513,318737,137592,9388,638551,344912,3688,125441,479361,73560,13556,9049
,411352,32990,628801]
CPU time: 102.39s
-}	

-- 6.3
-- 20 minutes
composites :: [Integer]
composites = filter (not . isPrime) [4..]

-- 6.4
-- 1 hour
	
test_fermat :: IO ()
test_fermat = do
  runs <- getRandomIntInRange 1 10
  putStrLn("Runs: " ++ show runs)
  amount <- getRandomIntInRange 1000 10000 
 
  perform_test runs amount composites  
  putStrLn ("Finished")

  where  
        perform_test 0 n (x:xs) = putStrLn("")
        perform_test a n xs = do        
          result <- test_fermat' a n xs      

          putStrLn("Run : " ++ show a ++ ", false primes:")
          putStrLn (show result)    
          putStrLn (show (length result) ++ " out of " ++ show n ++ " rendered false primes.")

          testTail <- perform_test (a-1) n xs                    
          putStrLn("")

        test_fermat' _ 0 _ = return []
        test_fermat' a n (x:xs) = do
          result <- primeF a x         
          testTail <- test_fermat' a (n-1) xs
          
          if result
	          then return (x : testTail)
	          else return testTail

{-
Lowest false positive : 4 

*Main> test_fermat
Runs: 5
Run : 5, false primes:
[1105,2821,8911,10585]
4 out of 9891 rendered false primes.
Run : 4, false primes:
[2465,8911,10585]
3 out of 9891 rendered false primes.
Run : 3, false primes:
[1105,1729,2821,10585]
4 out of 9891 rendered false primes.
Run : 2, false primes:
[231,1729,1891,3565,3641,5565,6601,8695,11041]
9 out of 9891 rendered false primes.
Run : 1, false primes:
[12,15,21,42,55,85,91,110,169,186,295,320,415,427,561,604,615,645,1102,1105,1247
,1261,1441,1457,1529,1617,1729,1825,1881,2047,2185,2278,2465,2565,2665,2821,3281
,3601,3795,3936,3977,4123,4465,5565,5833,6601,6721,6943,7161,7267,7769,7974,8029
,8474,8823,8851,8911,9409,9881,10885]
60 out of 9891 rendered false primes.
Finished

-}

-- 6.5
-- 10 minutes

test_fermat_carmichael :: IO ()
test_fermat_carmichael = do
  runs <- getRandomIntInRange 1 10 
  let amount = 200
 
  putStrLn("Carmichael: ")
  putStrLn("Runs: " ++ show runs)  

  print (take amount carmichael)
 
  falsePrimes <- perform_test runs amount carmichael    
  putStrLn (show falsePrimes ++ " out of " ++ show amount ++ " rendered false primes.") 	

  where  
        perform_test 0 n (x:xs) = return 0
        perform_test a n xs = do        
          result <- test_fermat' a n xs      
          putStrLn("Run : " ++ show a ++ ", false primes:")
          putStrLn (show (length result) ++ " out of " ++ show n ++ " rendered false primes.")
          putStrLn (show result)    

          testTail <- perform_test (a-1) n xs            
          return (length result)

        test_fermat' _ 0 _ = return []
        test_fermat' a n (x:xs) = do
          result <- primeF a x         
          testTail <- test_fermat' a (n-1) xs
          
          if result
	          then return (x : testTail)
	          else return testTail

{-

tested as in 6.4

*Main> test_fermat_carmichael
Carmichael:
Runs: 6
[294409,56052361,118901521,172947529,216821881,228842209,1299963601,2301745249,9
624742921,11346205609,13079177569,21515221081,27278026129,65700513721,7117130808
1,100264053529,168003672409,172018713961,173032371289,464052305161,527519713969,
663805468801,727993807201,856666552249,1042789205881,1201586232601,1396066334401
,1544001719761,1797002211241,1920595706641,2028691238689,2655343122121,271855784
4481,2724933935809,2920883888089,3091175755489,3267961077889,3296857440241,34141
46271409,3711619793521,3719466204049,3878725359169,4287981117241,4507445537641,6
323547512449,7622722964881,8544361005001,8681793690961,9332984447209,11004252611
041,11413778221441,11765530852489,13633039686169,14470947115561,14685655594249,1
4882678745409,15181505298649,17167430884969,18483957064801,20742413217121,218735
28379441,22027380041449,24285059687809,24977268314209,25825129162489,30833142247
729,33614369156161,35700127755121,37686301288201,39782913594409,48336382727569,5
3269464581929,57060521336809,58774132848169,62303597046289,67858397221969,708954
83772049,73103085605161,77833567590769,81159260227849,81466208375329,86483161466
209,91968282854641,95682503446921,98445661027561,105950928237841,112374872517529
,118895125737961,118974229155289,122570307044209,127393969917241,129140929242289
,137243534644009,168011973623089,177548395641481,184455452572849,192410140250521
,195809339861929,201375886537729,221568419989801,224093003069449,225301895806609
,233141908767121,251703127095769,262815637149001,280790932830409,312790579286329
,318705390188641,351025246957321,381144706349401,382177291511809,387194417159761
,390854788519609,413847154073161,415848433183849,428549255564041,439801455648601
,440937387145009,457240489374169,482944146230449,501291932351689,510637565929609
,548962252005961,566692953864841,572536569523969,601192212565969,621214363151929
,629346067180561,657623122439329,667316922191641,683938014196609,701865606427129
,726693182050249,742403294138881,779475417411169,787536877909321,795934611306001
,806090432846689,839110734385129,847577589374881,883519506462529,913671191480401
,920153949774049,921392227198801,937277770955329,938531360353681,938844932257009
,952711345022401,959377262271049,1004612946644089,1061085945064681,1146654351705
601,1161408537694369,1174103262876529,1205317701684289,1238966116844329,12537394
56971641,1288666276813009,1339280649331561,1343656902505249,1349240453427961,141
0449244539689,1429041795997609,1498183378245721,1687660433615521,171328920859260
1,1746281192537521,1753405565279761,1870541589252529,1882982959757929,1905516221
350249,1912563054372961,2031356908867969,2057172011015041,2070426828700441,20757
44656861201,2078939720299609,2173577642709409,2187327342530809,2242345598524081,
2362089119838841,2379535602228721,2408803612382521,2489624653085209,251675961376
1329,2779587596043649,2860540798515121,2887649314391089,2906926685502841,3046337
392794049,3328900397368921,3380206940558641,3410501308487209,3614533077626929,36
80409480386689,3715607011189609,3817748810243161,3931514590793329,40251305666768
41,4046687647375969]
Run : 6, false primes:
199 out of 200 rendered false primes.
[294409,56052361,118901521,172947529,228842209,1299963601,2301745249,9624742921,
11346205609,13079177569,21515221081,27278026129,65700513721,71171308081,10026405
3529,168003672409,172018713961,173032371289,464052305161,527519713969,6638054688
01,727993807201,856666552249,1042789205881,1201586232601,1396066334401,154400171
9761,1797002211241,1920595706641,2028691238689,2655343122121,2718557844481,27249
33935809,2920883888089,3091175755489,3267961077889,3296857440241,3414146271409,3
711619793521,3719466204049,3878725359169,4287981117241,4507445537641,63235475124
49,7622722964881,8544361005001,8681793690961,9332984447209,11004252611041,114137
78221441,11765530852489,13633039686169,14470947115561,14685655594249,14882678745
409,15181505298649,17167430884969,18483957064801,20742413217121,21873528379441,2
2027380041449,24285059687809,24977268314209,25825129162489,30833142247729,336143
69156161,35700127755121,37686301288201,39782913594409,48336382727569,53269464581
929,57060521336809,58774132848169,62303597046289,67858397221969,70895483772049,7
3103085605161,77833567590769,81159260227849,81466208375329,86483161466209,919682
82854641,95682503446921,98445661027561,105950928237841,112374872517529,118895125
737961,118974229155289,122570307044209,127393969917241,129140929242289,137243534
644009,168011973623089,177548395641481,184455452572849,192410140250521,195809339
861929,201375886537729,221568419989801,224093003069449,225301895806609,233141908
767121,251703127095769,262815637149001,280790932830409,312790579286329,318705390
188641,351025246957321,381144706349401,382177291511809,387194417159761,390854788
519609,413847154073161,415848433183849,428549255564041,439801455648601,440937387
145009,457240489374169,482944146230449,501291932351689,510637565929609,548962252
005961,566692953864841,572536569523969,601192212565969,621214363151929,629346067
180561,657623122439329,667316922191641,683938014196609,701865606427129,726693182
050249,742403294138881,779475417411169,787536877909321,795934611306001,806090432
846689,839110734385129,847577589374881,883519506462529,913671191480401,920153949
774049,921392227198801,937277770955329,938531360353681,938844932257009,952711345
022401,959377262271049,1004612946644089,1061085945064681,1146654351705601,116140
8537694369,1174103262876529,1205317701684289,1238966116844329,1253739456971641,1
288666276813009,1339280649331561,1343656902505249,1349240453427961,1410449244539
689,1429041795997609,1498183378245721,1687660433615521,1713289208592601,17462811
92537521,1753405565279761,1870541589252529,1882982959757929,1905516221350249,191
2563054372961,2031356908867969,2057172011015041,2070426828700441,207574465686120
1,2078939720299609,2173577642709409,2187327342530809,2242345598524081,2362089119
838841,2379535602228721,2408803612382521,2489624653085209,2516759613761329,27795
87596043649,2860540798515121,2887649314391089,2906926685502841,3046337392794049,
3328900397368921,3380206940558641,3410501308487209,3614533077626929,368040948038
6689,3715607011189609,3817748810243161,3931514590793329,4025130566676841,4046687
647375969]
Run : 5, false primes:
199 out of 200 rendered false primes.
[56052361,118901521,172947529,216821881,228842209,1299963601,2301745249,96247429
21,11346205609,13079177569,21515221081,27278026129,65700513721,71171308081,10026
4053529,168003672409,172018713961,173032371289,464052305161,527519713969,6638054
68801,727993807201,856666552249,1042789205881,1201586232601,1396066334401,154400
1719761,1797002211241,1920595706641,2028691238689,2655343122121,2718557844481,27
24933935809,2920883888089,3091175755489,3267961077889,3296857440241,341414627140
9,3711619793521,3719466204049,3878725359169,4287981117241,4507445537641,63235475
12449,7622722964881,8544361005001,8681793690961,9332984447209,11004252611041,114
13778221441,11765530852489,13633039686169,14470947115561,14685655594249,14882678
745409,15181505298649,17167430884969,18483957064801,20742413217121,2187352837944
1,22027380041449,24285059687809,24977268314209,25825129162489,30833142247729,336
14369156161,35700127755121,37686301288201,39782913594409,48336382727569,53269464
581929,57060521336809,58774132848169,62303597046289,67858397221969,7089548377204
9,73103085605161,77833567590769,81159260227849,81466208375329,86483161466209,919
68282854641,95682503446921,98445661027561,105950928237841,112374872517529,118895
125737961,118974229155289,122570307044209,127393969917241,129140929242289,137243
534644009,168011973623089,177548395641481,184455452572849,192410140250521,195809
339861929,201375886537729,221568419989801,224093003069449,225301895806609,233141
908767121,251703127095769,262815637149001,280790932830409,312790579286329,318705
390188641,351025246957321,381144706349401,382177291511809,387194417159761,390854
788519609,413847154073161,415848433183849,428549255564041,439801455648601,440937
387145009,457240489374169,482944146230449,501291932351689,510637565929609,548962
252005961,566692953864841,572536569523969,601192212565969,621214363151929,629346
067180561,657623122439329,667316922191641,683938014196609,701865606427129,726693
182050249,742403294138881,779475417411169,787536877909321,795934611306001,806090
432846689,839110734385129,847577589374881,883519506462529,913671191480401,920153
949774049,921392227198801,937277770955329,938531360353681,938844932257009,952711
345022401,959377262271049,1004612946644089,1061085945064681,1146654351705601,116
1408537694369,1174103262876529,1205317701684289,1238966116844329,125373945697164
1,1288666276813009,1339280649331561,1343656902505249,1349240453427961,1410449244
539689,1429041795997609,1498183378245721,1687660433615521,1713289208592601,17462
81192537521,1753405565279761,1870541589252529,1882982959757929,1905516221350249,
1912563054372961,2031356908867969,2057172011015041,2070426828700441,207574465686
1201,2078939720299609,2173577642709409,2187327342530809,2242345598524081,2362089
119838841,2379535602228721,2408803612382521,2489624653085209,2516759613761329,27
79587596043649,2860540798515121,2887649314391089,2906926685502841,30463373927940
49,3328900397368921,3380206940558641,3410501308487209,3614533077626929,368040948
0386689,3715607011189609,3817748810243161,3931514590793329,4025130566676841,4046
687647375969]
Run : 4, false primes:
200 out of 200 rendered false primes.
[294409,56052361,118901521,172947529,216821881,228842209,1299963601,2301745249,9
624742921,11346205609,13079177569,21515221081,27278026129,65700513721,7117130808
1,100264053529,168003672409,172018713961,173032371289,464052305161,527519713969,
663805468801,727993807201,856666552249,1042789205881,1201586232601,1396066334401
,1544001719761,1797002211241,1920595706641,2028691238689,2655343122121,271855784
4481,2724933935809,2920883888089,3091175755489,3267961077889,3296857440241,34141
46271409,3711619793521,3719466204049,3878725359169,4287981117241,4507445537641,6
323547512449,7622722964881,8544361005001,8681793690961,9332984447209,11004252611
041,11413778221441,11765530852489,13633039686169,14470947115561,14685655594249,1
4882678745409,15181505298649,17167430884969,18483957064801,20742413217121,218735
28379441,22027380041449,24285059687809,24977268314209,25825129162489,30833142247
729,33614369156161,35700127755121,37686301288201,39782913594409,48336382727569,5
3269464581929,57060521336809,58774132848169,62303597046289,67858397221969,708954
83772049,73103085605161,77833567590769,81159260227849,81466208375329,86483161466
209,91968282854641,95682503446921,98445661027561,105950928237841,112374872517529
,118895125737961,118974229155289,122570307044209,127393969917241,129140929242289
,137243534644009,168011973623089,177548395641481,184455452572849,192410140250521
,195809339861929,201375886537729,221568419989801,224093003069449,225301895806609
,233141908767121,251703127095769,262815637149001,280790932830409,312790579286329
,318705390188641,351025246957321,381144706349401,382177291511809,387194417159761
,390854788519609,413847154073161,415848433183849,428549255564041,439801455648601
,440937387145009,457240489374169,482944146230449,501291932351689,510637565929609
,548962252005961,566692953864841,572536569523969,601192212565969,621214363151929
,629346067180561,657623122439329,667316922191641,683938014196609,701865606427129
,726693182050249,742403294138881,779475417411169,787536877909321,795934611306001
,806090432846689,839110734385129,847577589374881,883519506462529,913671191480401
,920153949774049,921392227198801,937277770955329,938531360353681,938844932257009
,952711345022401,959377262271049,1004612946644089,1061085945064681,1146654351705
601,1161408537694369,1174103262876529,1205317701684289,1238966116844329,12537394
56971641,1288666276813009,1339280649331561,1343656902505249,1349240453427961,141
0449244539689,1429041795997609,1498183378245721,1687660433615521,171328920859260
1,1746281192537521,1753405565279761,1870541589252529,1882982959757929,1905516221
350249,1912563054372961,2031356908867969,2057172011015041,2070426828700441,20757
44656861201,2078939720299609,2173577642709409,2187327342530809,2242345598524081,
2362089119838841,2379535602228721,2408803612382521,2489624653085209,251675961376
1329,2779587596043649,2860540798515121,2887649314391089,2906926685502841,3046337
392794049,3328900397368921,3380206940558641,3410501308487209,3614533077626929,36
80409480386689,3715607011189609,3817748810243161,3931514590793329,40251305666768
41,4046687647375969]
Run : 3, false primes:
199 out of 200 rendered false primes.
[294409,56052361,118901521,172947529,216821881,228842209,1299963601,2301745249,1
1346205609,13079177569,21515221081,27278026129,65700513721,71171308081,100264053
529,168003672409,172018713961,173032371289,464052305161,527519713969,66380546880
1,727993807201,856666552249,1042789205881,1201586232601,1396066334401,1544001719
761,1797002211241,1920595706641,2028691238689,2655343122121,2718557844481,272493
3935809,2920883888089,3091175755489,3267961077889,3296857440241,3414146271409,37
11619793521,3719466204049,3878725359169,4287981117241,4507445537641,632354751244
9,7622722964881,8544361005001,8681793690961,9332984447209,11004252611041,1141377
8221441,11765530852489,13633039686169,14470947115561,14685655594249,148826787454
09,15181505298649,17167430884969,18483957064801,20742413217121,21873528379441,22
027380041449,24285059687809,24977268314209,25825129162489,30833142247729,3361436
9156161,35700127755121,37686301288201,39782913594409,48336382727569,532694645819
29,57060521336809,58774132848169,62303597046289,67858397221969,70895483772049,73
103085605161,77833567590769,81159260227849,81466208375329,86483161466209,9196828
2854641,95682503446921,98445661027561,105950928237841,112374872517529,1188951257
37961,118974229155289,122570307044209,127393969917241,129140929242289,1372435346
44009,168011973623089,177548395641481,184455452572849,192410140250521,1958093398
61929,201375886537729,221568419989801,224093003069449,225301895806609,2331419087
67121,251703127095769,262815637149001,280790932830409,312790579286329,3187053901
88641,351025246957321,381144706349401,382177291511809,387194417159761,3908547885
19609,413847154073161,415848433183849,428549255564041,439801455648601,4409373871
45009,457240489374169,482944146230449,501291932351689,510637565929609,5489622520
05961,566692953864841,572536569523969,601192212565969,621214363151929,6293460671
80561,657623122439329,667316922191641,683938014196609,701865606427129,7266931820
50249,742403294138881,779475417411169,787536877909321,795934611306001,8060904328
46689,839110734385129,847577589374881,883519506462529,913671191480401,9201539497
74049,921392227198801,937277770955329,938531360353681,938844932257009,9527113450
22401,959377262271049,1004612946644089,1061085945064681,1146654351705601,1161408
537694369,1174103262876529,1205317701684289,1238966116844329,1253739456971641,12
88666276813009,1339280649331561,1343656902505249,1349240453427961,14104492445396
89,1429041795997609,1498183378245721,1687660433615521,1713289208592601,174628119
2537521,1753405565279761,1870541589252529,1882982959757929,1905516221350249,1912
563054372961,2031356908867969,2057172011015041,2070426828700441,2075744656861201
,2078939720299609,2173577642709409,2187327342530809,2242345598524081,23620891198
38841,2379535602228721,2408803612382521,2489624653085209,2516759613761329,277958
7596043649,2860540798515121,2887649314391089,2906926685502841,3046337392794049,3
328900397368921,3380206940558641,3410501308487209,3614533077626929,3680409480386
689,3715607011189609,3817748810243161,3931514590793329,4025130566676841,40466876
47375969]
Run : 2, false primes:
200 out of 200 rendered false primes.
[294409,56052361,118901521,172947529,216821881,228842209,1299963601,2301745249,9
624742921,11346205609,13079177569,21515221081,27278026129,65700513721,7117130808
1,100264053529,168003672409,172018713961,173032371289,464052305161,527519713969,
663805468801,727993807201,856666552249,1042789205881,1201586232601,1396066334401
,1544001719761,1797002211241,1920595706641,2028691238689,2655343122121,271855784
4481,2724933935809,2920883888089,3091175755489,3267961077889,3296857440241,34141
46271409,3711619793521,3719466204049,3878725359169,4287981117241,4507445537641,6
323547512449,7622722964881,8544361005001,8681793690961,9332984447209,11004252611
041,11413778221441,11765530852489,13633039686169,14470947115561,14685655594249,1
4882678745409,15181505298649,17167430884969,18483957064801,20742413217121,218735
28379441,22027380041449,24285059687809,24977268314209,25825129162489,30833142247
729,33614369156161,35700127755121,37686301288201,39782913594409,48336382727569,5
3269464581929,57060521336809,58774132848169,62303597046289,67858397221969,708954
83772049,73103085605161,77833567590769,81159260227849,81466208375329,86483161466
209,91968282854641,95682503446921,98445661027561,105950928237841,112374872517529
,118895125737961,118974229155289,122570307044209,127393969917241,129140929242289
,137243534644009,168011973623089,177548395641481,184455452572849,192410140250521
,195809339861929,201375886537729,221568419989801,224093003069449,225301895806609
,233141908767121,251703127095769,262815637149001,280790932830409,312790579286329
,318705390188641,351025246957321,381144706349401,382177291511809,387194417159761
,390854788519609,413847154073161,415848433183849,428549255564041,439801455648601
,440937387145009,457240489374169,482944146230449,501291932351689,510637565929609
,548962252005961,566692953864841,572536569523969,601192212565969,621214363151929
,629346067180561,657623122439329,667316922191641,683938014196609,701865606427129
,726693182050249,742403294138881,779475417411169,787536877909321,795934611306001
,806090432846689,839110734385129,847577589374881,883519506462529,913671191480401
,920153949774049,921392227198801,937277770955329,938531360353681,938844932257009
,952711345022401,959377262271049,1004612946644089,1061085945064681,1146654351705
601,1161408537694369,1174103262876529,1205317701684289,1238966116844329,12537394
56971641,1288666276813009,1339280649331561,1343656902505249,1349240453427961,141
0449244539689,1429041795997609,1498183378245721,1687660433615521,171328920859260
1,1746281192537521,1753405565279761,1870541589252529,1882982959757929,1905516221
350249,1912563054372961,2031356908867969,2057172011015041,2070426828700441,20757
44656861201,2078939720299609,2173577642709409,2187327342530809,2242345598524081,
2362089119838841,2379535602228721,2408803612382521,2489624653085209,251675961376
1329,2779587596043649,2860540798515121,2887649314391089,2906926685502841,3046337
392794049,3328900397368921,3380206940558641,3410501308487209,3614533077626929,36
80409480386689,3715607011189609,3817748810243161,3931514590793329,40251305666768
41,4046687647375969]
Run : 1, false primes:
200 out of 200 rendered false primes.
[294409,56052361,118901521,172947529,216821881,228842209,1299963601,2301745249,9
624742921,11346205609,13079177569,21515221081,27278026129,65700513721,7117130808
1,100264053529,168003672409,172018713961,173032371289,464052305161,527519713969,
663805468801,727993807201,856666552249,1042789205881,1201586232601,1396066334401
,1544001719761,1797002211241,1920595706641,2028691238689,2655343122121,271855784
4481,2724933935809,2920883888089,3091175755489,3267961077889,3296857440241,34141
46271409,3711619793521,3719466204049,3878725359169,4287981117241,4507445537641,6
323547512449,7622722964881,8544361005001,8681793690961,9332984447209,11004252611
041,11413778221441,11765530852489,13633039686169,14470947115561,14685655594249,1
4882678745409,15181505298649,17167430884969,18483957064801,20742413217121,218735
28379441,22027380041449,24285059687809,24977268314209,25825129162489,30833142247
729,33614369156161,35700127755121,37686301288201,39782913594409,48336382727569,5
3269464581929,57060521336809,58774132848169,62303597046289,67858397221969,708954
83772049,73103085605161,77833567590769,81159260227849,81466208375329,86483161466
209,91968282854641,95682503446921,98445661027561,105950928237841,112374872517529
,118895125737961,118974229155289,122570307044209,127393969917241,129140929242289
,137243534644009,168011973623089,177548395641481,184455452572849,192410140250521
,195809339861929,201375886537729,221568419989801,224093003069449,225301895806609
,233141908767121,251703127095769,262815637149001,280790932830409,312790579286329
,318705390188641,351025246957321,381144706349401,382177291511809,387194417159761
,390854788519609,413847154073161,415848433183849,428549255564041,439801455648601
,440937387145009,457240489374169,482944146230449,501291932351689,510637565929609
,548962252005961,566692953864841,572536569523969,601192212565969,621214363151929
,629346067180561,657623122439329,667316922191641,683938014196609,701865606427129
,726693182050249,742403294138881,779475417411169,787536877909321,795934611306001
,806090432846689,839110734385129,847577589374881,883519506462529,913671191480401
,920153949774049,921392227198801,937277770955329,938531360353681,938844932257009
,952711345022401,959377262271049,1004612946644089,1061085945064681,1146654351705
601,1161408537694369,1174103262876529,1205317701684289,1238966116844329,12537394
56971641,1288666276813009,1339280649331561,1343656902505249,1349240453427961,141
0449244539689,1429041795997609,1498183378245721,1687660433615521,171328920859260
1,1746281192537521,1753405565279761,1870541589252529,1882982959757929,1905516221
350249,1912563054372961,2031356908867969,2057172011015041,2070426828700441,20757
44656861201,2078939720299609,2173577642709409,2187327342530809,2242345598524081,
2362089119838841,2379535602228721,2408803612382521,2489624653085209,251675961376
1329,2779587596043649,2860540798515121,2887649314391089,2906926685502841,3046337
392794049,3328900397368921,3380206940558641,3410501308487209,3614533077626929,36
80409480386689,3715607011189609,3817748810243161,3931514590793329,40251305666768
41,4046687647375969]
199 out of 200 rendered false primes.

CONCLUSION : ALMOST ALL RENDER FALSE PRIMES.

-}

-- 6.6

-- 15 mintues

test_mr_carmichael :: IO ()
test_mr_carmichael = do
  runs <- getRandomIntInRange 1 10 
  let amount = 200
 
  putStrLn("Carmichael: ")
  putStrLn("Runs: " ++ show runs)  

  print (take amount carmichael)
 
  falsePrimes <- perform_test runs amount carmichael    
  putStrLn (show falsePrimes ++ " out of " ++ show amount ++ " rendered false primes.")   

  where  
        perform_test 0 n (x:xs) = return 0
        perform_test a n xs = do        
          result <- test_mr' a n xs      
          putStrLn("Run : " ++ show a ++ ", false primes:")
          putStrLn (show (length result) ++ " out of " ++ show n ++ " rendered false primes.")
          putStrLn (show result)    

          testTail <- perform_test (a-1) n xs            
          return (length result)

        test_mr' _ 0 _ = return []
        test_mr' a n (x:xs) = do
          result <- primeMR a x         
          testTail <- test_mr' a (n-1) xs
          
          if result
            then return (x : testTail)
            else return testTail

{-
Runs: 4
[294409,56052361,118901521,172947529,216821881,228842209,1299963601,2301745249,9
624742921,11346205609,13079177569,21515221081,27278026129,65700513721,7117130808
1,100264053529,168003672409,172018713961,173032371289,464052305161,527519713969,
663805468801,727993807201,856666552249,1042789205881,1201586232601,1396066334401
,1544001719761,1797002211241,1920595706641,2028691238689,2655343122121,271855784
4481,2724933935809,2920883888089,3091175755489,3267961077889,3296857440241,34141
46271409,3711619793521,3719466204049,3878725359169,4287981117241,4507445537641,6
323547512449,7622722964881,8544361005001,8681793690961,9332984447209,11004252611
041,11413778221441,11765530852489,13633039686169,14470947115561,14685655594249,1
4882678745409,15181505298649,17167430884969,18483957064801,20742413217121,218735
28379441,22027380041449,24285059687809,24977268314209,25825129162489,30833142247
729,33614369156161,35700127755121,37686301288201,39782913594409,48336382727569,5
3269464581929,57060521336809,58774132848169,62303597046289,67858397221969,708954
83772049,73103085605161,77833567590769,81159260227849,81466208375329,86483161466
209,91968282854641,95682503446921,98445661027561,105950928237841,112374872517529
,118895125737961,118974229155289,122570307044209,127393969917241,129140929242289
,137243534644009,168011973623089,177548395641481,184455452572849,192410140250521
,195809339861929,201375886537729,221568419989801,224093003069449,225301895806609
,233141908767121,251703127095769,262815637149001,280790932830409,312790579286329
,318705390188641,351025246957321,381144706349401,382177291511809,387194417159761
,390854788519609,413847154073161,415848433183849,428549255564041,439801455648601
,440937387145009,457240489374169,482944146230449,501291932351689,510637565929609
,548962252005961,566692953864841,572536569523969,601192212565969,621214363151929
,629346067180561,657623122439329,667316922191641,683938014196609,701865606427129
,726693182050249,742403294138881,779475417411169,787536877909321,795934611306001
,806090432846689,839110734385129,847577589374881,883519506462529,913671191480401
,920153949774049,921392227198801,937277770955329,938531360353681,938844932257009
,952711345022401,959377262271049,1004612946644089,1061085945064681,1146654351705
601,1161408537694369,1174103262876529,1205317701684289,1238966116844329,12537394
56971641,1288666276813009,1339280649331561,1343656902505249,1349240453427961,141
0449244539689,1429041795997609,1498183378245721,1687660433615521,171328920859260
1,1746281192537521,1753405565279761,1870541589252529,1882982959757929,1905516221
350249,1912563054372961,2031356908867969,2057172011015041,2070426828700441,20757
44656861201,2078939720299609,2173577642709409,2187327342530809,2242345598524081,
2362089119838841,2379535602228721,2408803612382521,2489624653085209,251675961376
1329,2779587596043649,2860540798515121,2887649314391089,2906926685502841,3046337
392794049,3328900397368921,3380206940558641,3410501308487209,3614533077626929,36
80409480386689,3715607011189609,3817748810243161,3931514590793329,40251305666768
41,4046687647375969]
Run : 4, false primes:
0 out of 200 rendered false primes.
[]
Run : 3, false primes:
1 out of 200 rendered false primes.
[233141908767121]
Run : 2, false primes:
2 out of 200 rendered false primes.
[3719466204049,439801455648601]
Run : 1, false primes:
29 out of 200 rendered false primes.
[172947529,1396066334401,1920595706641,2724933935809,3414146271409,3719466204049
,4287981117241,13633039686169,24977268314209,25825129162489,30833142247729,23314
1908767121,280790932830409,510637565929609,779475417411169,795934611306001,95271
1345022401,1004612946644089,1061085945064681,1161408537694369,1288666276813009,1
429041795997609,1498183378245721,2070426828700441,2408803612382521,2906926685502
841,3046337392794049,3380206940558641,4025130566676841]
0 out of 200 rendered false primes.

Almost none render false primes.
-}            

-- 6.7

generateMersennePrimes :: Int -> Int -> IO([Integer])
generateMersennePrimes n acc = do 
  let mersennePrimes = [ (2^p-1) | p <- take n primes ]
  results <- filterM (\x -> primeMR acc x) mersennePrimes
  putStrLn(show (length results))
  return results
  
{-
*Main> generateMersennePrimes 100
13
[
3,
7,
31,
127,
8191,
131071,
524287,
2147483647,
2305843009213693951,
618970019642690137449562111,
162259276829213363391578010288127,
170141183460469231731687303715884105727,
6864797660130609714981900799081393217269435300143305409394463459185543183397656052122559640661454554977296311391480858037121987999716643812574028291115057151
]

Only 13 found. Integer size exceeded
-}